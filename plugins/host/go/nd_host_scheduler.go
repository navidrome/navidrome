// Code generated by hostgen. DO NOT EDIT.
//
// This file contains client wrappers for the Scheduler host service.
// It is intended for use in Navidrome plugins built with TinyGo.

package main

import (
	"encoding/json"
	"errors"

	"github.com/extism/go-pdk"
)

// scheduler_scheduleonetime is the host function provided by Navidrome.
//
//go:wasmimport extism:host/user scheduler_scheduleonetime
func scheduler_scheduleonetime(int32, uint64, uint64) uint64

// scheduler_schedulerecurring is the host function provided by Navidrome.
//
//go:wasmimport extism:host/user scheduler_schedulerecurring
func scheduler_schedulerecurring(uint64, uint64, uint64) uint64

// scheduler_cancelschedule is the host function provided by Navidrome.
//
//go:wasmimport extism:host/user scheduler_cancelschedule
func scheduler_cancelschedule(uint64) uint64

// SchedulerScheduleOneTimeResponse is the response type for Scheduler.ScheduleOneTime.
type SchedulerScheduleOneTimeResponse struct {
	NewScheduleID string `json:"newScheduleID,omitempty"`
	Error         string `json:"error,omitempty"`
}

// SchedulerScheduleRecurringResponse is the response type for Scheduler.ScheduleRecurring.
type SchedulerScheduleRecurringResponse struct {
	NewScheduleID string `json:"newScheduleID,omitempty"`
	Error         string `json:"error,omitempty"`
}

// SchedulerScheduleOneTime calls the scheduler_scheduleonetime host function.
// ScheduleOneTime schedules a one-time event to be triggered after the specified delay.
//
// Parameters:
//   - delaySeconds: Number of seconds to wait before triggering the event
//   - payload: Data to be passed to the scheduled event handler
//   - scheduleID: Optional unique identifier for the scheduled job. If empty, one will be generated
//
// Returns the schedule ID that can be used to cancel the job, or an error if scheduling fails.
func SchedulerScheduleOneTime(delaySeconds int32, payload []byte, scheduleID string) (*SchedulerScheduleOneTimeResponse, error) {
	payloadMem := pdk.AllocateBytes(payload)
	defer payloadMem.Free()
	scheduleIDMem := pdk.AllocateString(scheduleID)
	defer scheduleIDMem.Free()

	// Call the host function
	responsePtr := scheduler_scheduleonetime(delaySeconds, payloadMem.Offset(), scheduleIDMem.Offset())

	// Read the response from memory
	responseMem := pdk.FindMemory(responsePtr)
	responseBytes := responseMem.ReadBytes()

	// Parse the response
	var response SchedulerScheduleOneTimeResponse
	if err := json.Unmarshal(responseBytes, &response); err != nil {
		return nil, err
	}

	return &response, nil
}

// SchedulerScheduleRecurring calls the scheduler_schedulerecurring host function.
// ScheduleRecurring schedules a recurring event using a cron expression.
//
// Parameters:
//   - cronExpression: Standard cron format expression (e.g., "0 0 * * *" for daily at midnight)
//   - payload: Data to be passed to each scheduled event handler invocation
//   - scheduleID: Optional unique identifier for the scheduled job. If empty, one will be generated
//
// Returns the schedule ID that can be used to cancel the job, or an error if scheduling fails.
func SchedulerScheduleRecurring(cronExpression string, payload []byte, scheduleID string) (*SchedulerScheduleRecurringResponse, error) {
	cronExpressionMem := pdk.AllocateString(cronExpression)
	defer cronExpressionMem.Free()
	payloadMem := pdk.AllocateBytes(payload)
	defer payloadMem.Free()
	scheduleIDMem := pdk.AllocateString(scheduleID)
	defer scheduleIDMem.Free()

	// Call the host function
	responsePtr := scheduler_schedulerecurring(cronExpressionMem.Offset(), payloadMem.Offset(), scheduleIDMem.Offset())

	// Read the response from memory
	responseMem := pdk.FindMemory(responsePtr)
	responseBytes := responseMem.ReadBytes()

	// Parse the response
	var response SchedulerScheduleRecurringResponse
	if err := json.Unmarshal(responseBytes, &response); err != nil {
		return nil, err
	}

	return &response, nil
}

// SchedulerCancelSchedule calls the scheduler_cancelschedule host function.
// CancelSchedule cancels a scheduled job identified by its schedule ID.
//
// This works for both one-time and recurring schedules. Once cancelled, the job will not trigger
// any future events.
//
// Returns an error if the schedule ID is not found or if cancellation fails.
func SchedulerCancelSchedule(scheduelID string) error {
	scheduelIDMem := pdk.AllocateString(scheduelID)
	defer scheduelIDMem.Free()

	// Call the host function
	responsePtr := scheduler_cancelschedule(scheduelIDMem.Offset())

	// Read the response from memory
	responseMem := pdk.FindMemory(responsePtr)
	errStr := string(responseMem.ReadBytes())

	if errStr != "" {
		return errors.New(errStr)
	}

	return nil
}
