# Navidrome Host Function Wrappers for Go

This directory contains auto-generated Go wrappers for Navidrome's host services.
These wrappers provide idiomatic Go APIs for interacting with Navidrome from WASM plugins.

## ⚠️ Auto-Generated Code

**Do not edit these files manually.** They are generated by the `ndpgen` tool.

To regenerate:

```bash
make generate-pdk
```

## Usage

Add this module as a dependency in your plugin's `go.mod`:

```go
require github.com/navidrome/navidrome/plugins/pdk/go/host v0.0.0

replace github.com/navidrome/navidrome/plugins/pdk/go/host => ../../pdk/go/host
```

Then import the package in your plugin code:

```go
package main

import (
    host "github.com/navidrome/navidrome/plugins/pdk/go/host"
    "github.com/extism/go-pdk"
)

func myPluginFunction() error {
    // Use the cache service
    _, err := host.CacheSetString("my_key", "my_value", 3600)
    if err != nil {
        return err
    }

    // Schedule a recurring task  
    _, err = host.SchedulerScheduleRecurring("@every 5m", "payload", "task_id")
    if err != nil {
        return err
    }

    // Access library data with typed structs
    resp, err := host.LibraryGetAllLibraries()
    if err != nil {
        return err
    }
    for _, lib := range resp.Result {
        pdk.Log(pdk.LogInfo, fmt.Sprintf("Library: %s with %d songs", lib.Name, lib.TotalSongs))
    }

    return nil
}
```

## Typed Structs

Services that work with domain objects provide typed Go structs instead of
`map[string]interface{}`. This enables compile-time type checking and IDE
autocompletion.

For example, the library service provides a `Library` struct:

```go
resp, err := host.LibraryGetAllLibraries()
if err != nil {
    return err
}
for _, lib := range resp.Result {
    fmt.Printf("Library: %s (%d songs)\n", lib.Name, lib.TotalSongs)
}
```

## Available Services

| Module        | Description                                        |
|---------------|----------------------------------------------------|
| `Artwork`     | Access album and artist artwork                    |
| `Cache`       | Temporary key-value storage with TTL               |
| `KVStore`     | Persistent key-value storage                       |
| `Library`     | Access the music library (albums, artists, tracks) |
| `Scheduler`   | Schedule one-time and recurring tasks              |
| `SubsonicAPI` | Make Subsonic API calls                            |
| `WebSocket`   | Send real-time messages to clients                 |

## Building Plugins

Go plugins must be compiled to WebAssembly using TinyGo:

```bash
tinygo build -o plugin.wasm -target=wasip1 -buildmode=c-shared .
```
