# Code generated by ndpgen. DO NOT EDIT.
#
# This file contains client wrappers for the Config host service.
# It is intended for use in Navidrome plugins built with extism-py.
#
# IMPORTANT: Due to a limitation in extism-py, you cannot import this file directly.
# The @extism.import_fn decorators are only detected when defined in the plugin's
# main __init__.py file. Copy the needed functions from this file into your plugin.

from dataclasses import dataclass
from typing import Any

import extism
import json


class HostFunctionError(Exception):
    """Raised when a host function returns an error."""
    pass


@extism.import_fn("extism:host/user", "config_get")
def _config_get(offset: int) -> int:
    """Raw host function - do not call directly."""
    ...


@extism.import_fn("extism:host/user", "config_getint")
def _config_getint(offset: int) -> int:
    """Raw host function - do not call directly."""
    ...


@extism.import_fn("extism:host/user", "config_keys")
def _config_keys(offset: int) -> int:
    """Raw host function - do not call directly."""
    ...


@dataclass
class ConfigGetResult:
    """Result type for config_get."""
    value: str
    exists: bool


@dataclass
class ConfigGetIntResult:
    """Result type for config_get_int."""
    value: int
    exists: bool


def config_get(key: str) -> ConfigGetResult:
    """Get retrieves a configuration value as a string.

Parameters:
  - key: The configuration key

Returns the value and whether the key exists.

    Args:
        key: str parameter.

    Returns:
        ConfigGetResult containing value, exists,.

    Raises:
        HostFunctionError: If the host function returns an error.
    """
    request = {
        "key": key,
    }
    request_bytes = json.dumps(request).encode("utf-8")
    request_mem = extism.memory.alloc(request_bytes)
    response_offset = _config_get(request_mem.offset)
    response_mem = extism.memory.find(response_offset)
    response = json.loads(extism.memory.string(response_mem))

    return ConfigGetResult(
        value=response.get("value", ""),
        exists=response.get("exists", False),
    )


def config_get_int(key: str) -> ConfigGetIntResult:
    """GetInt retrieves a configuration value as an integer.

Parameters:
  - key: The configuration key

Returns the value and whether the key exists. If the key exists but the
value cannot be parsed as an integer, exists will be false.

    Args:
        key: str parameter.

    Returns:
        ConfigGetIntResult containing value, exists,.

    Raises:
        HostFunctionError: If the host function returns an error.
    """
    request = {
        "key": key,
    }
    request_bytes = json.dumps(request).encode("utf-8")
    request_mem = extism.memory.alloc(request_bytes)
    response_offset = _config_getint(request_mem.offset)
    response_mem = extism.memory.find(response_offset)
    response = json.loads(extism.memory.string(response_mem))

    return ConfigGetIntResult(
        value=response.get("value", 0),
        exists=response.get("exists", False),
    )


def config_keys(prefix: str) -> Any:
    """Keys returns configuration keys matching the given prefix.

Parameters:
  - prefix: Key prefix to filter by. If empty, returns all keys.

Returns a sorted slice of matching configuration keys.

    Args:
        prefix: str parameter.

    Returns:
        Any: The result value.

    Raises:
        HostFunctionError: If the host function returns an error.
    """
    request = {
        "prefix": prefix,
    }
    request_bytes = json.dumps(request).encode("utf-8")
    request_mem = extism.memory.alloc(request_bytes)
    response_offset = _config_keys(request_mem.offset)
    response_mem = extism.memory.find(response_offset)
    response = json.loads(extism.memory.string(response_mem))

    return response.get("keys", None)
