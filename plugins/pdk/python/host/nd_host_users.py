# Code generated by ndpgen. DO NOT EDIT.
#
# This file contains client wrappers for the Users host service.
# It is intended for use in Navidrome plugins built with extism-py.
#
# IMPORTANT: Due to a limitation in extism-py, you cannot import this file directly.
# The @extism.import_fn decorators are only detected when defined in the plugin's
# main __init__.py file. Copy the needed functions from this file into your plugin.

from dataclasses import dataclass
from typing import Any

import extism
import json


class HostFunctionError(Exception):
    """Raised when a host function returns an error."""
    pass


@extism.import_fn("extism:host/user", "users_getusers")
def _users_getusers(offset: int) -> int:
    """Raw host function - do not call directly."""
    ...


@extism.import_fn("extism:host/user", "users_getadmins")
def _users_getadmins(offset: int) -> int:
    """Raw host function - do not call directly."""
    ...


def users_get_users() -> Any:
    """GetUsers returns all users the plugin has been granted access to.
Only minimal user information (userName, name, isAdmin) is returned.
Sensitive fields like password and email are never exposed.

Returns a slice of users the plugin can access, or an empty slice if none configured.

    Returns:
        Any: The result value.

    Raises:
        HostFunctionError: If the host function returns an error.
    """
    request_bytes = b"{}"
    request_mem = extism.memory.alloc(request_bytes)
    response_offset = _users_getusers(request_mem.offset)
    response_mem = extism.memory.find(response_offset)
    response = json.loads(extism.memory.string(response_mem))

    if response.get("error"):
        raise HostFunctionError(response["error"])

    return response.get("result", None)


def users_get_admins() -> Any:
    """GetAdmins returns only admin users the plugin has been granted access to.
This is a convenience method that filters GetUsers results to include only admins.

Returns a slice of admin users the plugin can access, or an empty slice if none.

    Returns:
        Any: The result value.

    Raises:
        HostFunctionError: If the host function returns an error.
    """
    request_bytes = b"{}"
    request_mem = extism.memory.alloc(request_bytes)
    response_offset = _users_getadmins(request_mem.offset)
    response_mem = extism.memory.find(response_offset)
    response = json.loads(extism.memory.string(response_mem))

    if response.get("error"):
        raise HostFunctionError(response["error"])

    return response.get("result", None)
