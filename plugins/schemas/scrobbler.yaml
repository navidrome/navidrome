version: v1-draft

exports:
  nd_scrobbler_is_authorized:
    description: Check if a user is authorized to scrobble to this service
    input:
      $ref: "#/components/schemas/AuthInput"
      contentType: application/json
    output:
      $ref: "#/components/schemas/AuthOutput"
      contentType: application/json

  nd_scrobbler_now_playing:
    description: Send a now playing notification to the scrobbling service
    input:
      $ref: "#/components/schemas/NowPlayingInput"
      contentType: application/json
    output:
      $ref: "#/components/schemas/ScrobblerOutput"
      contentType: application/json

  nd_scrobbler_scrobble:
    description: Submit a completed scrobble to the scrobbling service
    input:
      $ref: "#/components/schemas/ScrobbleInput"
      contentType: application/json
    output:
      $ref: "#/components/schemas/ScrobblerOutput"
      contentType: application/json

components:
  schemas:
    AuthInput:
      description: Input for authorization check
      properties:
        userId:
          type: string
          description: The internal Navidrome user ID
        username:
          type: string
          description: The username of the user
      required:
        - userId
        - username

    AuthOutput:
      description: Output for authorization check
      properties:
        authorized:
          type: boolean
          description: Whether the user is authorized to scrobble
      required:
        - authorized

    TrackInfo:
      description: Track metadata for scrobbling
      properties:
        id:
          type: string
          description: The internal Navidrome track ID
        title:
          type: string
          description: Track title
        album:
          type: string
          description: Album name
        artist:
          type: string
          description: Track artist
        albumArtist:
          type: string
          description: Album artist
        duration:
          type: number
          format: float
          description: Track duration in seconds
        trackNumber:
          type: integer
          format: int32
          description: Track number on the album
        discNumber:
          type: integer
          format: int32
          description: Disc number
        mbzRecordingId:
          type: string
          nullable: true
          description: MusicBrainz recording ID
        mbzAlbumId:
          type: string
          nullable: true
          description: MusicBrainz album/release ID
        mbzArtistId:
          type: string
          nullable: true
          description: MusicBrainz artist ID
        mbzReleaseGroupId:
          type: string
          nullable: true
          description: MusicBrainz release group ID
        mbzAlbumArtistId:
          type: string
          nullable: true
          description: MusicBrainz album artist ID
        mbzReleaseTrackId:
          type: string
          nullable: true
          description: MusicBrainz release track ID
      required:
        - id
        - title
        - album
        - artist
        - albumArtist
        - duration
        - trackNumber
        - discNumber

    NowPlayingInput:
      description: Input for now playing notification
      properties:
        userId:
          type: string
          description: The internal Navidrome user ID
        username:
          type: string
          description: The username of the user
        track:
          $ref: "#/components/schemas/TrackInfo"
          description: The track currently playing
        position:
          type: integer
          format: int32
          description: Current playback position in seconds
      required:
        - userId
        - username
        - track
        - position

    ScrobbleInput:
      description: Input for submitting a scrobble
      properties:
        userId:
          type: string
          description: The internal Navidrome user ID
        username:
          type: string
          description: The username of the user
        track:
          $ref: "#/components/schemas/TrackInfo"
          description: The track that was played
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp when the track started playing
      required:
        - userId
        - username
        - track
        - timestamp

    ScrobblerOutput:
      description: Output for scrobbler operations (now_playing and scrobble)
      properties:
        error:
          type: string
          nullable: true
          description: Error message if the operation failed
        errorType:
          $ref: "#/components/schemas/ScrobblerErrorType"
          nullable: true
          description: Type of error for handling

    ScrobblerErrorType:
      type: string
      description: Error type indicating how Navidrome should handle the error
      enum:
        - none
        - not_authorized
        - retry_later
        - unrecoverable
