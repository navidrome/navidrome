// Code generated by hostgen. DO NOT EDIT.
//
// This file contains client wrappers for the Store host service.
// It is intended for use in Navidrome plugins built with TinyGo.
//
//go:build wasip1

package main

import (
	"encoding/json"

	"github.com/extism/go-pdk"
)

// store_save is the host function provided by Navidrome.
//
//go:wasmimport extism:host/user store_save
func store_save(uint64) uint64

// StoreSaveRequest is the request type for Store.Save.
type StoreSaveRequest struct {
	Item Item `json:"item"`
}

// StoreSaveResponse is the response type for Store.Save.
type StoreSaveResponse struct {
	Id    string `json:"id,omitempty"`
	Error string `json:"error,omitempty"`
}

// StoreSave calls the store_save host function.
func StoreSave(item Item) (*StoreSaveResponse, error) {
	// Marshal request to JSON
	req := StoreSaveRequest{
		Item: item,
	}
	reqBytes, err := json.Marshal(req)
	if err != nil {
		return nil, err
	}
	reqMem := pdk.AllocateBytes(reqBytes)
	defer reqMem.Free()

	// Call the host function
	responsePtr := store_save(reqMem.Offset())

	// Read the response from memory
	responseMem := pdk.FindMemory(responsePtr)
	responseBytes := responseMem.ReadBytes()

	// Parse the response
	var response StoreSaveResponse
	if err := json.Unmarshal(responseBytes, &response); err != nil {
		return nil, err
	}

	return &response, nil
}
