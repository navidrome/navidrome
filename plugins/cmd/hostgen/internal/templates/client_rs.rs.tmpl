// Code generated by hostgen. DO NOT EDIT.
//
// This file contains client wrappers for the {{.Service.Name}} host service.
// It is intended for use in Navidrome plugins built with extism-pdk.

use extism_pdk::*;
use serde::{Deserialize, Serialize};
{{- range .Service.Methods}}
{{- if .HasParams}}

#[derive(Debug, Clone, Serialize)]
#[serde(rename_all = "camelCase")]
struct {{requestType .}} {
{{- range .Params}}
    {{.RustName}}: {{.RustType}},
{{- end}}
}
{{- end}}

#[derive(Debug, Clone, Deserialize)]
#[serde(rename_all = "camelCase")]
struct {{responseType .}} {
{{- range .Returns}}
    #[serde(default)]
    {{.RustName}}: {{.RustType}},
{{- end}}
    #[serde(default)]
    error: Option<String>,
}
{{- end}}

#[host_fn]
extern "ExtismHost" {
{{- range .Service.Methods}}
    fn {{exportName .}}(input: Json<{{if .HasParams}}{{requestType .}}{{else}}serde_json::Value{{end}}>) -> Json<{{responseType .}}>;
{{- end}}
}

{{- /* Generate wrapper functions */ -}}
{{range .Service.Methods}}

{{if .Doc}}{{rustDocComment .Doc}}{{else}}/// Calls the {{exportName .}} host function.{{end}}
{{- if .HasParams}}
///
/// # Arguments
{{- range .Params}}
/// * `{{.RustName}}` - {{.RustType}} parameter.
{{- end}}
{{- end}}
{{- if .HasReturns}}
///
/// # Returns
{{- if eq (len .Returns) 1}}
/// The {{(index .Returns 0).RustName}} value.
{{- else}}
/// A tuple of ({{range $i, $r := .Returns}}{{if $i}}, {{end}}{{$r.RustName}}{{end}}).
{{- end}}
{{- end}}
///
/// # Errors
/// Returns an error if the host function call fails.
pub fn {{rustFunc .}}({{range $i, $p := .Params}}{{if $i}}, {{end}}{{$p.RustName}}: {{$p.RustParamType}}{{end}}) -> Result<{{if eq (len .Returns) 0}}(){{else if eq (len .Returns) 1}}{{(index .Returns 0).RustType}}{{else}}({{range $i, $r := .Returns}}{{if $i}}, {{end}}{{$r.RustType}}{{end}}){{end}}, Error> {
    let response = unsafe {
{{- if .HasParams}}
        {{exportName .}}(Json({{requestType .}} {
{{- range .Params}}
            {{.RustName}}: {{.RustName}}{{if .NeedsToOwned}}.to_owned(){{end}},
{{- end}}
        }))?
{{- else}}
        {{exportName .}}(Json(serde_json::json!({})))?
{{- end}}
    };

    if let Some(err) = response.0.error {
        return Err(Error::msg(err));
    }
{{if eq (len .Returns) 0}}
    Ok(())
{{- else if eq (len .Returns) 1}}
    Ok(response.0.{{(index .Returns 0).RustName}})
{{- else}}
    Ok(({{range $i, $r := .Returns}}{{if $i}}, {{end}}response.0.{{$r.RustName}}{{end}}))
{{- end}}
}
{{- end}}
